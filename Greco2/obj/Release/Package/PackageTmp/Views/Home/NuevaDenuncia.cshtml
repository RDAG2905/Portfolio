@using Greco2.Models.Evento
@model Greco2.Models.Denuncia.DenunciaModelView

<style>

    .completar {
        border-color: orangered;
    }

    input[type=text], input[type=date], input[type=time], label {
        max-width: 280px;
        height: 30px;
        margin-right: 50px;
    }

    text {
        color: dodgerblue;
        margin-left: 10px;
        /*margin-top: 15px;*/
        max-width: 220px;
        /*background-color:lightgray;*/
    }

    .leftText {
        text-align: left;
    }

    input[type=checkbox] {
        margin-left: 80px;
        margin-right: 1px;
    }

    /*#comboOrganismos, #comboEstudios, #comboModalidadGestion, #comboSubTipoProceso, #comboMediador, #comboDomicilioMediador,
    #comboMotivoReclamo, #comboServicioDenunciado, #comboEstadoConciliacion, #comboTipoEvento, #comboReqInforme,
    #comboListaTipoEvento {
        width: 180px;
    }*/

    input[type=button] {
        border-radius: 4px;
    }

    .h-divider {
        margin-top: 25px;
        /*margin-bottom: 5px;*/
        height: 1px;
        width: 100%;
        border-top: 1px solid #0066ff;
    }

    .borde {
        /*display:flex;*/
        /*border-style: solid;*/
        background-color: white;
        /*border-color: #cccccc;*/
        /*border-color: #808080;*/
        border-color: #999999;
        border-color: lightgray;
        border-width: 1px;
        border-radius: 4px;
        margin-top: 5px;
        margin-bottom: 5px;
        /*margin-left: -25px;*/
        padding-left: 40px;
        padding-right: 20px;
        padding-top: 30px;
        padding-bottom: 30px;
    }

    #ParentContainer, #grupoDenunciantesContainer {
        /*background-color: #f2f2f2;*/
        background-color: #e6e6e6;
        border-radius: 4px;
        padding-top: 10px;
        /*margin-left: -10px auto;
        margin-right: -10px auto;*/
        /*width:1200px;*/
    }

    #grupoDenunciantesContainer {
        padding-left: 30px;
        padding-right: 30px;
        padding-bottom: 30px;
        display: flex;
        justify-content: center;
    }

    #Buscador, #Cleaner, #alta {
        margin-left: -30px;
        height: 25px;
        /*width:25px;*/
        justify-content: center;
        padding-left: 7px;
        padding-right: 7px;
    }

    #checkEvento {
        margin-left: 10PX;
    }

    .bordeBotonera {
        border-radius: 4px;
        padding-left: 25px;
        padding-top: 6px;
        padding-bottom: 6px;
        text-align: center;
        background-color: white;
        height: 42px;
    }

    .btnGuardar {
        padding-left: 50px;
        padding-right: 50px;
    }

    .container-fluid {
        margin: 0 auto;
    }

    th {
        max-width: 200px;
        padding: 5px 5px 5px 5px;
    }

    table {
        text-align: center;
    }

    .menu {
        /*background-color: #00547E;*/
        /*background-color: #002966;*/
        background-color: #337ab7; /*#0066ff #0047b3 #262626 #666666 #d9d9d9 #bfbfbf #337ab7*/
        /*background:linear-gradient(#002966,#0047b3);*/
        /*border-bottom: 8px solid #04A3ED;*/
        border-bottom: 4px solid #04A3ED;
        /*border-bottom: 4px solid #d9d9d9;*/
        border-radius: 4px;
        width: 120%;
        height: 40px;
        /*padding: 10px 10px;*/
        position: static;
        margin-top: -20px;
        /*margin: 0px;*/
        margin-left: -110px;
        /*margin-right: -50px;*/
        z-index: 1;
        /*height: 35px;*/
        /*opacity: 0.9;*/
    }

        .menu .navbar-nav > .active > a {
            background-color: #04A3ED;
            color: white;
            font-weight: bold;
        }

        .menu .navbar-nav > li > a {
            font-size: 13px;
            color: white;
            padding: 10px 35px;
        }

            .menu .navbar-nav > li > a:hover {
                background-color: #04A3ED;
            }

    .navbar-header > a {
        font-family: 'Ubuntu Condensed', sans-serif;
        padding: 0px;
        margin: 0px;
        text-decoration: none;
        color: white;
        font-size: 25px;
        /*font-size: 20px;*/
        padding: 5px 30px;
    }

        .navbar-header > a:hover {
            text-decoration: none;
            color: #04A3ED;
        }

    .form-control {
        max-height: 30px;
    }

    .row {
        max-height: 55px;
    }


    /*a:active {
        background-color: #e6e6e6;
    }*/

</style>@*background-color: #f2f2f2;*@


<div class="container">
    <div id="navHeader" class="navbar navbar-default navbar-header" style="height:20px;width:120%;margin-left:-120px;margin-bottom:-5px;">
        <div class="row">
            <input style="margin-left:150px;" type="button" name="name" value="Visualizar Modificaciones" class="btn btn-sm btn-primary" />
            <input type="button" name="name" value="Formalizar Denuncia" class="btn btn-sm btn-primary" />
        </div>
    </div>
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#home">Datos Generales</a></li>
        <li><a data-toggle="tab" href="#menu1">Denunciantes</a></li>
        <li><a data-toggle="tab" href="#menu2">Datos Coprec</a></li>
        <li><a data-toggle="tab" href="#menu3">Previsiones</a></li>
        <li id="linkDocuments"><a data-toggle="tab" href="#menu4">Documentos</a></li>
    </ul>

    <div class="tab-content">
        <br />
        <div id="homeDenuncia" class="tab-pane fade in active">

            <div display="flex" id="ParentContainer" class="col-xs-12">
                <div class="borde">
                    <div class="row">
                        <label class="col-xs-2">Etapa Procesal: </label>
                        @Html.DropDownListFor(m => m.estadoSeleccionado, Model.Estados, "", new { @class = "col-xs-1 form-control", id = "comboEtapaProcesal",style = "margin-left:-30px;margin-right:40px;" })

                        <label class="col-xs-2">Número Denuncia: </label>
                        <text id="nroDenuncia" class="col-xs-1">@Model.DenunciaId</text>
                    </div>
                    <div class="row">
                        <label class="col-xs-2">Tipo Proceso: </label>@*m.tipoProcesoSeleccionado*@

                        @Html.DropDownListFor(m => m.tipoDenuncia, Model.tiposProceso, "", new { @class = "col-xs-1 form-control", id = "comboTiposProceso",style = "margin-left:-30px;margin-right:40px;" })

                        <label class="col-xs-2">Usuario Creador: </label>
                        <text class="col-xs-2">Usuario-Creador</text>
                    </div>
                    <div class="row">
                        <label class="col-xs-2">Denuncia Preventiva: </label>
                        <label class="col-xs-3"></label>
                        <label class="col-xs-2" style="margin-left:-30px;">Denuncia Formal: </label>
                        <label class="col-xs-3"></label>
                    </div>
                </div>
                

                <div class="borde">
                    <div class="row">
                        <label class="col-xs-3">Denunciante : </label>
                        <img src="@Url.Content("~/Images/4.gif")" id="loading" style="display:none;" />
                        <div style="color:dodgerblue;font-family: 'Times New Roman', Times, serif"
                             id="denuncianteResult">@Model.datosDenunciante</div>

                        </div>

                        <input type="hidden" id="denuncianteId" />
                        <input type="hidden" id="creationDate" value="@DateTime.Now" />
                        <br />

                        <div class="row">
                            <label class="col-xs-3">Dni Denunciante : </label>
                            <input type="text" class="form-control col-xs-3" placeholder="DNI Denunciante" id="dni" />
                            <button class="btn btn-info btn-sm" id="Buscador" type="submit"><i class="glyphicon glyphicon-search"></i></button>

                            <input id="denuncianteIndividual" type="checkbox" checked/>
                            <label>Denunciante Individual</label>
                        </div>
                        <div class="row">
                            <label class="col-xs-3">Nombre : </label>
                            <input type="text" class="form-control col-xs-3" placeholder="Nombre Denunciante" id="nombre" />
                            <button class="btn btn-info btn-sm" id="Cleaner"><i class="glyphicon glyphicon-remove"></i></button>
                        </div>
                        <div class="row">
                            <label class="col-xs-3">Apellido : </label>
                            <input type="text" class="form-control col-xs-3" placeholder="Apellido Denunciante" id="apellido" />
                            <button class="btn btn-primary btn-sm" id="alta"><i class="glyphicon glyphicon-export"></i></button>
                           
                        </div>


                    </div>

                    <div class="borde">
                        <div class="row">
                            <label class="col-xs-3">Tramite CRM : </label>
                            <input type="text" id="tramiteCrm" class="form-control col-xs-3" placeholder="Tramite CRM" style="margin-left: -120px;" value="@Model.denuncia.TRAMITECRM" />
                            <label class="col-xs-3">Número de Línea : </label>
                            <input type="text" id="numeroLinea" class="form-control col-xs-3" placeholder="Nro de Linea" style="margin-left: -120px;" value="@Model.denuncia.OBJETORECLAMO" />
                        </div>
                        <div class="row">
                            <label class="col-xs-3">Nro de Cliente/Contrato : </label>
                            <input type="text" id="numeroClienteContrato" class="form-control col-xs-3" placeholder="Nro de Cliente/Contrato" style="margin-left: -120px;" />
                        </div>
                    </div>

                    <div class="borde">
                        <div class="row">
                            <label class="col-xs-3">Fecha de Notificacion: </label>
                            <input id="fechaNotificacion" type="date" class="form-control col-xs-1" placeholder="Fecha de Notificacion" style="margin-left:-120px;" />
                            <label class="col-xs-3">Fecha Notificacion Gcia: </label>
                            <input id="fechaNotificacionGcia" type="date" class="form-control col-xs-1" placeholder="Fecha de Notificacion Gcia" style="margin-left:-120px;" />
                        </div>

                        <div class="row">
                            <label class="col-xs-2" style="margin-right:140px;">Nro Expediente: </label>
                            <input type="text" id="numeroExpediente" class="form-control col-xs-1" placeholder="Nro de Expediente" style="margin-left: -120px;" />
                            <label class="col-xs-3">Responsable Interno: </label>
                            <text class="col-xs-3">Responsable-Interno</text>
                        </div>
                    </div>


                    <div class="borde">
                        <div class="row">
                            <label class="col-xs-2">Organismo: </label>
                            @Html.DropDownListFor(m => m.organismoSeleccionado, Model.Organismos, "", new { @class = "col-xs-1 form-control", id = "comboOrganismo", style = "margin-left:-30px;margin-right:40px;" })

                            <label class="col-xs-2">Estudio Jurídico: </label>
                            @Html.DropDownListFor(m => m.estudioSeleccionado, Model.Estudios, "", new { @class = "col-xs-1 form-control", id = "comboEstudio", style = "margin-left:-30px;margin-right:40px;" })
                        </div>

                        <div class="row">
                            <label class="col-xs-2">Modalidad Gestión: </label>
                            @Html.DropDownListFor(m => m.modalidadGestionSeleccionada, Model.modalidadesDeGestion, "", new { @class = "col-xs-1 form-control", id = "comboModalidadesGestion", style = "margin-left:-30px;margin-right:40px;" })

                            <label class="col-xs-2">SubTipo Proceso: </label>
                            @Html.DropDownListFor(m => m.subTipoProcesoSeleccionado, Model.subTiposProceso, "", new { @class = "col-xs-1 form-control", id = "comboSubTiposProceso", style = "margin-left:-30px;margin-right:40px;" })

                        </div>
                        <div id="bloqueCamposCoprec" style="display:none;">
                            <div class="row">
                                <label class="col-xs-2">Mediador : </label>
                                @Html.DropDownListFor(m => m.mediadorSeleccionado, Model.mediadores, "", new { @class = "col-xs-1 form-control", id = "comboMediadores", style = "margin-left:-30px;margin-right:40px;" })
                                @*<input type="text" class="form-control col-xs-1" id="mediador" style="margin-left:-30px" placeholder="Mediador" />*@

                                <label class="col-xs-2" @*style="margin-left:-10px;"*@>Domicilio Mediador: </label>
                                @Html.DropDownListFor(m => m.domicilioMediadorSeleccionado, Model.domiciliosMediadores, "", new { @class = "col-xs-1 form-control", id = "comboDomiciliosMediadores", style = "margin-left:-30px;margin-right:40px;" })
                                @*<input type="text" class="col-xs-2" id="domicilioMediador" />*@
                            </div>
                            <div class="row">
                                <label class="col-xs-2">Reclamo Relacionado: </label>
                                <input type="text" class="form-control col-xs-3" id="reclamoRelacionado" placeholder="Reclamo Relacionado" style="margin-left:-30px;" value="@Model.denuncia.reclamoRelacionado"/>
                            </div>
                        </div>
                    </div>

                    <div class="borde">
                        <div class="row">
                            <label class="col-xs-2">Servicio Denunciado: </label>
                            @Html.DropDownListFor(m => m.servicioSeleccionado, Model.Servicios, "", new { @class = "col-xs-1 form-control", id = "comboServicios", style = "margin-left:-30px;margin-right:40px;" })

                            <label class="col-xs-2">Motivo Reclamo: </label>
                            @Html.DropDownListFor(m => m.motivoReclamoSeleccionado, Model.motivosDeReclamo, "", new { @class = "col-xs-1 form-control", id = "comboMotivosReclamo", style = "margin-left:-30px;margin-right:40px;" })

                        </div>

                        <div class="row">
                            <label class="col-xs-2">Estado Conciliación: </label>
                            @Html.DropDownListFor(m => m.subEstadoSeleccionado, Model.SubEstados, "", new { @class = "col-xs-1 form-control", id = "comboSubEstados", style = "margin-left:-30px;margin-right:40px;" })

                            <label class="col-xs-2">Fecha  Resultado:</label>
                            <input type="date" class="form-control col-xs-1" id="fechaResultado" placeholder="Fecha de Resultado" style="margin-left:-30px;" />
                        </div>


                    </div>
                    <div class="borde">
                        <div class="row">
                            <input type="hidden" id="tipoEvento" value="3" />
                            <label class="col-xs-2">Tipo Evento</label>
                            @Html.DropDownListFor(m => m.tipoEventoSeleccionado, Model.tipoEventos, "", new { @class = "col-xs-1 form-control", id = "comboTipoEventos", style = "margin-left:-30px;margin-right:40px;" })

                            @*<input type="hidden" id="reqInforme" value="2" />*@
                            <label class="col-xs-2">Req.Informe:</label>
                            @Html.DropDownListFor(m => m.reqInformeSeleccionado, Model.reqsInforme, "", new { @class = "col-xs-1 form-control", id = "comboReqsInforme", style = "margin-left:-30px;margin-right:40px;" })

                        </div>

                        <div class="row">
                            <label class="col-xs-2">Fecha Vencimiento: </label>
                            <input id="fechaVencimiento" type="date" class="form-control col-xs-1" style="margin-left:-30px;" />
                            <label class="col-xs-2" style="margin-left: -10px;">Hora Vencimiento: </label>
                            <input type="time" id="horaVencimiento" class="form-control col-xs-1" style="margin-left:-30px;" />
                        </div>
                    </div>

                    <div class="bordeBotonera">
                        <div class="row">
                            <div>
                                <input type="button" class="btn btn-primary btn-sm btnGuardar" value="Guardar" id="GuardarDenuncia" />
                            </div>
                        </div>
                    </div>
                    <div class="borde" style="padding-top:10px;padding-bottom:10px;">

                        <div class="row" style="display:none;">
                            <h4 style="padding-left:30px;" class="col-xs-2">Eventos</h4>
                        </div>
                        <div class="row" style="display:none;">
                            @Html.DropDownListFor(m => m.tipoEventoSeleccionado, Model.tipoEventos, "", new { @class = "col-xs-1 form-control", id = "comboReqsInforme", style = "margin-right:20px;" })
                            <input type="button" value="Nuevo" class="btn btn-info btn-sm col-xs-1" />
                        </div>
                    </div>
                    <div id="divlistaEventos" class="borde" style="display:none;">

                        @Html.Partial("Eventos", Model.eventos)

                    </div>
                </div>


            </div>

            <div id="menu1" class="tab-pane fade" style="display:none;">

                <br />
                

                @*@Html.Partial("GrupoDenunciantes");*@
                <div id="grupoDenunciantesContainer">
                        <div class="borde" style="padding-right:40px">
                            <div class="list-group-item" style="border:2px inherit;" id="incrementadorDeDenunciantes">
                                <div class="row">
                                    <label style="margin-right:10px;margin-left:80px;" class="col-xs-1">Agregar </label>
                                    <input style="max-width:100px;text-align:center;" id="cantidadDenunciantes" class="form-control input-sm col-xs-1" onkeypress="" />
                                    <div class="col-xs-1" style="margin-right:50px;" onclick="limpiarInput('cantidadDenunciantes');"><i  style="color:darkgray;" class="glyphicon glyphicon-backward"></i></div>

                                    <button id="btnClearTable" class="col-xs-1 btn btn-default" onclick="eliminarFilasGrupo();"><i style="color:darkgray;" class="glyphicon glyphicon-fast-backward"></i></button>

                                    <label style="margin-right:10px;margin-left:80px;" class="col-xs-1">Quitar </label>
                                    <input style="max-width:100px;text-align:center;" id="cantidadDenunciantesASacar" class="form-control input-sm col-xs-1" />
                                    <div class="col-xs-1"><i onclick="limpiarInput('cantidadDenunciantesASacar');" style="color:darkgray;" class="glyphicon glyphicon-backward"></i></div>
                                </div>
                            </div>
                            <br />
                            <div id="divListaDenunciantes">
                                <table id="lista" class="table" style="width:900px;">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th class="text-center">Nombre</th>
                                            <th class="text-center">Apellido</th>
                                            <th class="text-center">Dni</th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>

                                </table>
                            </div>
                                <div class="navbar-right">
                                    @*<button class="btn btn-default"><i class="glyphicon glyphicon-trash"></i></button>*@
                                    <button id="guardarGrupoDenunciantes" class="btn btn-sm btn-primary right" style="margin-right:80px;">Guardar</button>
                                </div>
                            </div>
                    </div>

            </div>
            <div id="menu2" class="tab-pane fade">
                <h3>Datos Coprec</h3>

            </div>
            <div id="menu3" class="tab-pane fade">
                <h3>Previsiones</h3>

            </div>
            <div id="menu4" class="tab-pane fade">

                <div class="jumbotron">
                    <form action="~/Home/SaveDropzoneJsUploadedFiles" class="dropzone" id="dropzoneJsForm"></form>
                    <br />
                    <input type="button" id="submit-all" class="btn btn-primary btn-sm" value="Agregar" />

                </div>

                <div id="FileList">

                </div>


            </div>
        </div>
    </div>

    @section scripts{
        @*@Scripts.Render("~/bundles/jqueryval")*@
        <script type="text/javascript">
            var orden = 1;


            //$(document).ready(function () {

                var tbody = $('#lista tbody');
                var fila_contenido = tbody.find('tr').first().html();
                //Agregar fila nueva.
                $('#lista .button_agregar').click(function () {
                    var fila_nueva = $('<tr></tr>');
                    fila_nueva.append(fila_contenido);
                    orden++;
                    fila_nueva.find('td').first().replaceWith(orden);
                    tbody.append(fila_nueva);
                });

                //Eliminar fila.
                $('#lista').on('click', '.button_eliminar', function () {
                    $(this).parents('tr').eq(0).remove();

                });


                //var cantidadFilas;
                //function generarNFilas(cantidadFilas) {
                //    var tbody = $('#lista tbody');
                //    var fila_contenido = tbody.find('tr').first().html();
                //    //var fila_contenido = tbody.find('tr').first().clone();
                //    for (i = 0; i < cantidadFilas; i++) {

                //        var filaNueva = $('<tr></tr>');
                //        filaNueva.append(fila_contenido);
                //        //console.log(filaNueva);
                //            orden++;
                //            filaNueva.find('td').first().replaceWith(orden);
                //        tbody.append(filaNueva);
                //        //tbody.append(fila_contenido);
                //    }
                //}

                //var cantidadFilas;
                function generarNFilas(cantidadFilas) {
                    //var orden = 0;
                    var i = 0;
                    var tbody = $('#lista tbody');
                    fila = '<tr><td></td><td><input type="text" class="form-control"/></td><td><input type="text" class="form-control"/></td><td><input type="text" class="form-control"/></td></tr>';
                    console.log(tbody.find('tr').length);
                    //if (tbody.find('tr').length == 0) {
                    //    i = 1;
                    //    //alert(i);
                    //} else {
                    //    i = tbody.find('tr').last().find('td').first().val() + 1;
                    //    //alert(i);
                    //}
                    //if (tbody.find('tr').length == 0) {
                    for (i = 1; i <= cantidadFilas; i++) {
                        tbody.append(fila);
                        tbody.find('tr').last().find('td').first().replaceWith(i);
                    }
                    //}
                    //else {
                    //    for (i = 1; i <= cantidadFilas; i++) {
                    //        tbody.append(fila);
                    //        tbody.find('tr').last().find('td').first().replaceWith(i);
                    //    }
                    //}
                    //tbody.find('tr').each(function (j, valor) {
                    //    $(valor).find('td').first().replaceWith(i);
                    //});
                }

                //var nFilasABorrar;
                function removerNFilas(nFilasABorrar) {
                    var tbody = $('#lista tbody');
                    var cantidadFilasTabla = document.querySelector("#lista").rows.length - 1;
                    console.log(cantidadFilasTabla);

                    var cantidad = 0;
                    var n = cantidadFilasTabla;

                    while (n >= 1 && (nFilasABorrar > cantidad)) {

                        $("#lista").find("tr").last().remove();
                        n--;
                        cantidad++;

                    }
                    orden = $("#lista").find("tr").last().find("td").eq(0).val();
                    console.log(orden);

                }

                $("#cantidadDenunciantes").keypress(function (e) {
                    if (e.which == 13) {
                        e.preventDefault();
                        generarNFilas($(this).val());
                        console.log($(this).val());
                        $(this).val = 0;
                    }
            });

            //function crearFilas() {

            //}


                $("#cantidadDenunciantesASacar").keypress(function (e) {
                    if (e.which == 13) {
                        e.preventDefault();
                        removerNFilas($(this).val());
                        $(this).val = 0;
                    }
                });



                $("#lista").on('click', '.button_agregar', function () {
                    $('#lista .button_agregar').click(function () {
                        var fila_nueva = $('<tr></tr>');
                        fila_nueva.append(fila_contenido);
                        orden++;
                        fila_nueva.find('td').first().replaceWith(orden);
                        tbody.append(fila_nueva);
                    });
            });

            $('#denuncianteIndividual').click(function () {
                if (!$(this).is(':checked')) {
                    $('#menu1').show();
                    $('#denuncianteIndividual').on('click', function () { });
                } else {
                    $('#menu1').hide();
                }
            });

    function quitarDelGrupo(denuncianteId, elem) {
            var boton = $(elem);
            console.log(boton);
            var fila = $(elem).parent().parent();
            console.log(fila);
            $.ajax({
                url: '@Url.Action("QuitarDelGrupo","Denuncias")',
                type: 'GET',
                data: {
                    id: denuncianteId,
                    grupoId: $('#grupoDenuncianteId').text()
                },
                success(response) {
                    toastr.success(response);
                    fila.remove();
                },
                error(response) {
                    toastr.error(response.responseText);
                }
            });

        }


                function eliminarFilasGrupo() {
                    var tbody = $('#lista tbody');
                    tbody.empty();
                }

                var listadoDenunciantes = [];
                
                $('#guardarGrupoDenunciantes').click(function () {
                    var fila = [];
                    var n = 0;
                    $('#lista tbody tr').each(function (i, valor) {
                        
                        fila.push($(valor).find('td').eq(0).children().val());
                        fila.push($(valor).find('td').eq(1).children().val());
                        fila.push($(valor).find('td').eq(2).children().val());
                        //fila.push($(valor).find('td').eq(3).children().val());
                        //fila[1] = $(valor).find('td').eq(1).children().val();
                        //fila[2] = $(valor).find('td').eq(2).children().val();
                        //fila[3] = $(valor).find('td').eq(3).children().val();
                        listadoDenunciantes.push(fila);
                        fila = [];
                    });
                    console.log(listadoDenunciantes);
                    console.log(listadoDenunciantes.length);
                    if (listadoDenunciantes.length <= 1) {
                        toastr.options.positionClass = 'toast-bottom-full-width'; /*'toast-bottom-right'*/
                        toastr.warning('.......................................................................... Para crear un Grupo de Denunciantes se requieren al menos 2 Integrantes');
                    }
                    else {
                        $.ajax({
                            url: '@Url.Action("CrearGrupo","Denuncias")',
                            type: 'Post',
                            data: { lista: listadoDenunciantes },
                            success(response) {
                                console.log(response)
                                $('#divListaDenunciantes').html(response);
                                $('#idGrupo').val($('#grupoDenuncianteId').text())
                                var nombrePrincipal = $('#nombreDenunciantePrincipal').val();
                                var apellidoPrincipal = $('#apellidoDenunciantePrincipal').val();
                                var dniPrincipal = $('#dniDenunciantePrincipal').val();
                                console.log(nombrePrincipal);
                                console.log(apellidoPrincipal);
                                console.log(dniPrincipal);
                                console.log($('#idDenunciantePrincipal').val());
                                $('#denuncianteResult').html(nombrePrincipal + " " + apellidoPrincipal + " " + dniPrincipal);
                                $('#denuncianteId').val($('#idDenunciantePrincipal').val());
                                //$('#incrementadorDeDenunciantes').css("display","none");
                                $('#btnClearTable').attr("disabled",true);
                            },
                            error(response) {
                                toastr.error(response.responseText);
                            }  
                        });
                        listadoDenunciantes = [];
                    }
                });

                function limpiarInput(elemento) {
                    var elem = '#' + elemento
                    console.log($(elem));
                    $(elem).val('');
                }


            //});
        </script>

        <script>
        $("#fechaNotificacion").change(function () {
            $("#fechaNotificacionGcia").val($(this).val());
        });

        $('#Cleaner').click(function () {
            $('#dni').val("");
            $('#nombre').val("");
            $('#apellido').val("");
        });


        $("#dni").keypress(function (e) {
            if (e.which == 13) {
                e.preventDefault();
                GetDenunciante();
            }
        });

        $("#apellido").keypress(function (e) {
            if (e.which == 13) {
                e.preventDefault();
                GetDenunciante();
            }
        });

        $("#nombre").keypress(function (e) {
            if (e.which == 13) {
                e.preventDefault();
                GetDenunciante();
            }
        });



        $("#Buscador").click(function () {
            $.ajax({
                url: "/Home/GetDenunciante",
                type: "Post",
                data: {
                    dni: $('#dni').val(),
                    nombre: $('#nombre').val(),
                    apellido: $('#apellido').val()
                },
                success: function (response) {
                    $('#denuncianteResult').html(response);

                },
                error: function (response) {
                    alert(response);
                }
            });
        });

//llevados a denunciaEdición
        $("#comboServicios").change(function () {
            $.ajax({
                url: '@Url.Action("GetMotivosDeReclamoPorServicio", "Home")',
                type: "Post",
                data: {
                    idServicio: $('#comboServicios option:selected').val()
                },
                success: function (response) {
                    $('#comboMotivosReclamo').empty();
                    $('#comboMotivosReclamo').append('<option value=0/>');
                    $(response).each(function () {
                        $('#comboMotivosReclamo').append(
                            $('<option/>', { value: this.Id }).html(this.Nombre)
                        );
                    });


                },
                error: function (response) {
                    toastr.error(response);
                }
            });
        });

         $("#comboOrganismo").change(function () {
            $.ajax({
                url: '@Url.Action("GetEstudiosPorOrganismo", "Home")',
                type: "Post",
                data: {
                    organismoId: $('#comboOrganismo option:selected').val()
                },
                success: function (response) {
                    $('#comboEstudio').empty();
                    $('#comboEstudio').append('<option value=0/>');
                    $(response).each(function () {
                        $('#comboEstudio').append(
                            $('<option/>', { value: this.EstudioRelacionId }).html(this.Estudio)
                        );
                    });
                    if ($('#comboOrganismo option:selected').text().includes('COPREC')) {
                        $('#bloqueCamposCoprec').show();
                    } else {
                        $('#bloqueCamposCoprec').hide();
                    }
                },
                error: function (response) {
                    toastr.error(response);
                }
            });
        });

        function mostrarLoading() {
            $('#denuncianteResult').empty();
            $('#loading').show();
        };

        function ocultarLoading() {
            $('#loading').hide();
        };

        function GetDenunciante() {
         //falta deshabilitar los campos durante el envio
            var dni = $('#dni').val();
            if (isEmpty(dni) && faltaCompletarLosDatos()) {
                toastr.info("Ingrese un filtro de Búsqueda");
            }
            else {
                mostrarLoading();
                $.ajax({
                    url: "/Home/GetDenunciante",
                    type: "Post",
                    data: {
                        dni: $('#dni').val(),
                        nombre: $('#nombre').val(),
                        apellido: $('#apellido').val()
                    },
                    success: function (response) {
                        $('#loading').hide();
                        $('#denuncianteResult').html(response);
                        $('#denuncianteId').val($('#idDenunciante').val());


                    },
                    error: function (response) {
                        $('#loading').hide();
                        toastr("Ocurrió un Error Inesperado");
                    }
                });
            }
        };

        function faltaCompletarLosDatos() {
            var nombre = $('#nombre').val();
            var apellido = $('#apellido').val();
            return isEmpty(nombre) || isEmpty(apellido);

        };

        function validarYGuardarDenunciante() {

            if (faltaCompletarLosDatos()) {
                toastr.info("Ingrese nombre y apellido");
            } else {
                guardarDenunciante();
            }
        };

        function isEmpty(id) {
            return id.length == 0
        }

        function guardarDenunciante() {
            mostrarLoading();
                    $.ajax({
                        url: "/Home/Guardar",
                        type: "Post",
                        data: {
                            dni: $('#dni').val(),
                            nombre: $('#nombre').val(),
                            apellido: $('#apellido').val()
                        },
                        success: function (response) {
                            toastr.options.positionClass = 'toast-bottom-right';
                            ocultarLoading();
                            $('#denuncianteResult').html(response);
                            $('#denuncianteId').val($('#idDenunciante').val());
                            var id = $('#denuncianteId').val();
                            if (isEmpty(id)) {
                                toastr.info("Ya existe un Denunciante con esa descripción");
                            } else {
                                toastr.success("Se ha guardado correctamente");
                            }

                        },
                          error: function (response) {
                              toastr.error(response.statusCode + ' : ' + response.statusText);
                        }
                    });

                }


        $("#alta").click(function () {
            $(this).attr("disable", true);
            validarYGuardarDenunciante();
            $(this).attr("disable", false);
        });

        $("#GuardarDenuncia").click(function () {
            mostrarLoading();
            $("html, body").animate({ scrollTop: $("#navHeader").offset().top }, 500);
            $.ajax({
                url: '@Url.Action("CrearDenuncia", "Denuncias")',
                type: "Post",
                data: {
                    ETAPA_ID: $('#comboEtapaProcesal option:selected').val(),
                    TIPO_PRO_ID: $('#comboTiposProceso option:selected').val(),
                    DENUNCIANTE_ID: $('#denuncianteId').val(),
                    CREATIONDATE: $('#creationDate').val(),
                    TRAMITECRM: $('#tramiteCrm').val(),
                    OBJETORECLAMO: $('#numeroLinea').val(),
                    FSELLOCIA : $('#fechaNotificacion').val(),
                    FSELLOGCIADC : $('#fechaNotificacionGcia').val(),
                    EXPEDIENTE_ID: $('#numeroExpediente').val(),
                    ORGANISMO_ID: $('#comboOrganismo option:selected').val(),
                    ESTUDIO_ID: $('#comboEstudio option:selected').val(),
                    MODALIDADGESTION: $('#comboModalidadesGestion  option:selected').val(),
                    SUBTIPO_PRO_ID: $('#comboSubTiposProceso option:selected').val(),
                    SERV_DEN_ID: $('#comboServicios option:selected').val(),
                    RECLAMO_ID: $('#comboMotivosReclamo option:selected').val(),
                    CONCILIACION_ID: $('#comboSubEstados option:selected').val(),
                    FECHARESULTADO: $('#fechaResultado').val(),
                    tipoEvento: $('#comboTipoEventos option:selected').val(),
                    reqInforme: $('#comboReqsInforme option:selected').val(),
                    fechaVencimiento: $('#fechaVencimiento').val(),
                    horaVencimiento: $('#horaVencimiento').val(),
                    grupoId: $('#grupoDenuncianteId').val(),
                    nroClienteContrato: $('#numeroClienteContrato').val(),
                    mediadorId: $('#comboMediadores option:selected').val(),
                    domicilioMediadorId: $('#comboDomiciliosMediadores option:selected').val(),
                    reclamoRelacionado: $('#reclamoRelacionado').val()
                },

                success: function (response) {
                    toastr.options.positionClass = 'toast-bottom-right';
                    toastr.success("Se ha guardado correctamente");

                    try {
                        $('#homeDenuncia').html(response);
                            } catch (response) {
                        ocultarLoading();
                        toastr.error(response.responseText + ' ' + response.status);
                    } finally {
                        ocultarLoading();
                    }                   
                },
                error: function (response) {
                    toastr.error(response.responseText);

               }
            });

        });

            function esDenunciaValida() {
                if ($('#denuncianteId').val() == 0) {

                }
            }

            function editarDenuncia() {
                 mostrarLoading();
            $("html, body").animate({ scrollTop: $("#navHeader").offset().top }, 500);
            $.ajax({
                url: '@Url.Action("EditarDenuncia", "Denuncias")',
                type: "POST",
                data: {
                    ETAPA_ID: $('#comboEtapaProcesal option:selected').val(),
                    TIPO_PRO_ID: $('#comboTiposProceso option:selected').val(),
                    DENUNCIANTE_ID: $('#denuncianteId').val(),
                    CREATIONDATE: $('#creationDate').val(),
                    TRAMITECRM: $('#tramiteCrm').val(),
                    OBJETORECLAMO: $('#numeroLinea').val(),
                    FSELLOCIA : $('#fechaNotificacion').val(),
                    FSELLOGCIADC : $('#fechaNotificacionGcia').val(),
                    EXPEDIENTE_ID: $('#numeroExpediente').val(),
                    ORGANISMO_ID: $('#comboOrganismo option:selected').val(),
                    ESTUDIO_ID: $('#comboEstudio option:selected').val(),
                    MODALIDADGESTION: $('#comboModalidadesGestion  option:selected').val(),
                    SUBTIPO_PRO_ID: $('#comboSubTiposProceso option:selected').val(),
                    SERV_DEN_ID: $('#comboServicios option:selected').val(),
                    RECLAMO_ID: $('#comboMotivosReclamo option:selected').val(),
                    CONCILIACION_ID: $('#comboSubEstados option:selected').val(),
                    FECHARESULTADO: $('#fechaResultado').val(),
                    tipoEvento: $('#comboTipoEventos option:selected').val(),
                    reqInforme: $('#comboReqsInforme option:selected').val(),
                    fechaVencimiento: $('#fechaVencimiento').val(),
                    horaVencimiento: $('#horaVencimiento').val(),
                    grupoId: $('#grupoDenuncianteId').val(),
                    nroClienteContrato: $('#nroClienteContrato').val(),
                    mediadorId: $('#comboMediadores option:selected').val(),
                    domicilioMediadorId: $('#comboDomiciliosMediadores option:selected').val(),
                    reclamoRelacionado: $('#reclamoRelacionado').val()
                },

                success: function (response) {
                    toastr.options.positionClass = 'toast-bottom-right';
                    toastr.success("Se ha guardado correctamente");

                    try {
                        $('#homeDenuncia').html(response);
                            } catch (response) {
                        ocultarLoading();
                        toastr.error(response.responseText + ' ' + response.status);
                    } finally {
                        ocultarLoading();
                    }                   
                },
                error: function (response) {
                    toastr.error(response.responseText);
                    ocultarLoading();
               }
            });
                ocultarLoading();
        
            }
            //denuncia edicion
             $("#linkDocuments").click(function () {
                                        $.ajax({
                                            url: "/Home/Archivos",
                                            type: "Get",
                                            //data: {
                                            //    dni: $('#dni').val(),
                                            //    nombre: $('#nombre').val(),
                                            //    apellido: $('#apellido').val()
                                            //},
                                            success: function (response) {
                                                $('#FileList').html(response);

                                            },
                                            error: function (response) {
                                                alert(response);
                                            }
                                        });
                                    });
                                    var orden = 1;
                                //$('#guardarNuevoEvento').on('onclick', function () {
                                //    console.log($('#fechaVencimiento').length);
                                //        console.log($('#horaVencimiento').val());
                                //        console.log($('#tipoEvento option:selected').val());
                                //    });


                                    var tbody = $('#lista tbody');
                                    var fila_contenido = tbody.find('tr').first().html();
                                    //Agregar fila nueva.
                                    $('#lista .button_agregar').click(function () {
                                        var fila_nueva = $('<tr></tr>');
                                        fila_nueva.append(fila_contenido);
                                        orden++;
                                        fila_nueva.find('td').first().replaceWith(orden);
                                        tbody.append(fila_nueva);
                                    });

                                    //Eliminar fila.
                                    $('#lista').on('click', '.button_eliminar', function () {
                                        $(this).parents('tr').eq(0).remove();

                                    });


                                    var cantidadFilas;
                                    function generarNFilas(cantidadFilas) {
                                        var tbody = $('#lista tbody');
                                        var fila_contenido = tbody.find('tr').first().html();

                                        for (i = 0; i < cantidadFilas; i++) {

                                            var filaNueva = $('<tr></tr>');
                                            filaNueva.append(fila_contenido);
                                            console.log(filaNueva);
                                            orden++;
                                            filaNueva.find('td').first().replaceWith(orden);
                                            tbody.append(filaNueva);

                                        }
                                    }

                                    var nFilasABorrar;
                                    function removerNFilas(nFilasABorrar) {
                                        var tbody = $('#lista tbody');
                                        var cantidadFilasTabla = document.querySelector("#lista").rows.length - 1;
                                        console.log(cantidadFilasTabla);

                                        var cantidad = 0;
                                        var n = cantidadFilasTabla;

                                        while (n > 1 && (nFilasABorrar > cantidad)) {

                                            $("#lista").find("tr").last().remove();
                                            n--;
                                            cantidad++;

                                        }
                                        orden = $("#lista").find("tr").last().find("td").eq(0).val();
                                        console.log(orden);

                                    }

                                    $("#cantidadDenunciantes").keypress(function (e) {
                                        if (e.which == 13) {
                                            e.preventDefault();
                                            generarNFilas($(this).val());
                                            $(this).val = 0;
                                        }
                                    });

                                    $("#cantidadDenunciantesASacar").keypress(function (e) {
                                        if (e.which == 13) {
                                            e.preventDefault();
                                            removerNFilas($(this).val());
                                            $(this).val = 0;
                                        }
                                    });



                                    $("#lista").on('click', '.button_agregar', function () {
                                        $('#lista .button_agregar').click(function () {
                                            var fila_nueva = $('<tr></tr>');
                                            fila_nueva.append(fila_contenido);
                                            orden++;
                                            fila_nueva.find('td').first().replaceWith(orden);
                                            tbody.append(fila_nueva);
                                        });
                                    });





            $("#fechaNotificacion").change(function () {
                $("#fechaNotificacionGcia").val($(this).val());
            });

            $('#Cleaner').click(function () {
                $('#dni').val("");
                $('#nombre').val("");
                $('#apellido').val("");
            });


            $("#dni").keypress(function (e) {
                if (e.which == 13) {
                    e.preventDefault();
                    GetDenunciante();
                }
            });

            $("#apellido").keypress(function (e) {
                if (e.which == 13) {
                    e.preventDefault();
                    GetDenunciante();
                }
            });

            $("#nombre").keypress(function (e) {
                if (e.which == 13) {
                    e.preventDefault();
                    GetDenunciante();
                }
            });


                                function esUnEventoVálido() {
                                    var control = true;
                                    if ($('#fechaVencimiento').val().length == 0) {
                                        toastr.warning('Ingrese la Fecha De Vencimiento');
                                        control = false;
                                    }
                                    if ($('#horaVencimiento').val().length == 0) {
                                        toastr.warning('Ingrese la Hora De Vencimiento');
                                        control = false;
                                    }
                                    if ($('#evento_tipoEvento')[0].selectedIndex == 0) {
                                        toastr.warning('Seleccione un Tipo de Evento');
                                        control = false;
                                    }
                                    //$('#guardarNuevoEvento').attr("data-dismiss","modal");
                                    return control;
                                }


                                function guardarNuevoEvento() {

                                    //if (esUnEventoVálido()) {
                                        $.ajax({
                                            url: '@Url.Action("CrearEvento","Denuncias")',
                                            type: "Post",
                                            data: {
                                                DenunciaId: $('#nroDenuncia').text(),
                                                Fecha: $('#fechaVencimiento').val() + ' ' + $('#horaVencimiento').val(),
                                                //horaVencimiento: $('#horaVencimiento').val(),
                                                tipoEvento: $('#evento_tipoEvento option:selected').val(),
                                                contestado: $('#contestado').val(),
                                                solucionado: $('#solucionadoSeleccionado option:selected').val(),
                                                REQUERIMIENTOINFORME: $('#evento_REQUERIMIENTOINFORME option:selected').val(),
                                                observacion: $('#evento_Observacion').val()
                                            },
                                                success(response){
                                                    toastr.success('Evento guardado correctamente');
                                                    $('#divlistaEventos').html(response);
                                            },
                                            error(response) {
                                                //toastr.options.positionClass = 'top-full-widht';
                                                toastr.error(response.responseText + ' ' + response.statusText)
                                                }
                                        });
                                    //}

                                }

                                function validarTipoEvento() {
                                    if ($('#comboTipoEventoNuevo')[0].selectedIndex == 0) {
                                        toastr.warning("Debe seleccionar un Tipo de Evento");
                                    } else {
                                        $('#nuevoEvento').attr("disabled", false);
                                    }
                                }
            //$("#btn-CrearEvento").click(function () {
            //    $.ajax({
            //        url: "/Home/NuevoEvento",
            //        type: "Get",
            //        data: {
            //            //dni: $('#dni').val(),
            //            //nombre: $('#nombre').val(),
            //            //apellido: $('#apellido').val()
            //        },
            //        success: function (response) {
            //            $('#NewEventContainer').html(response);

            //        },
            //        error: function (response) {
            //            alert(response);
            //        }
            //    });
            //});


            //$('#comboTipoEventoNuevo').change(function () {
            //    $('#idTipoEventoSeleccionado').val($('#comboTipoEventoNuevo option:selected').val());
            //    $('#tipoEventoSeleccionado').val($('#comboTipoEventoNuevo option:selected').text());
            //    if ($(this)[0].selectedIndex != 0) {
            //        $('#nuevoEvento').attr("disabled", false);
            //    } else {
            //        $('#nuevoEvento').attr("disabled", true);
            //    }

            //});

            $("#Buscador").click(function () {
                $.ajax({
                    url: "/Home/GetDenunciante",
                    type: "Post",
                    data: {
                        dni: $('#dni').val(),
                        nombre: $('#nombre').val(),
                        apellido: $('#apellido').val()
                    },
                    success: function (response) {
                        $('#denuncianteResult').html(response);

                    },
                    error: function (response) {
                        alert(response);
                    }
                });
            });

            function mostrarLoading() {
                $('#denuncianteResult').empty();
                $('#loading').show();
            };

            function ocultarLoading() {
                $('#loading').hide();
            };

            function GetDenunciante() {
                //falta deshabilitar los campos durante el envio
                var dni = $('#dni').val();
                if (isEmpty(dni) && faltaCompletarLosDatos()) {
                    toastr.info("Ingrese un filtro de Búsqueda");
                }
                else {
                    mostrarLoading();
                    $.ajax({
                        url: "/Home/GetDenunciante",
                        type: "Post",
                        data: {
                            dni: $('#dni').val(),
                            nombre: $('#nombre').val(),
                            apellido: $('#apellido').val()
                        },
                        success: function (response) {
                            $('#loading').hide();
                            $('#denuncianteResult').html(response);
                            $('#denuncianteId').val($('#idDenunciante').val());


                        },
                        error: function (response) {
                            $('#loading').hide();
                            toastr("Ocurrió un Error Inesperado");
                        }
                    });
                }
            };

            function faltaCompletarLosDatos() {
                var nombre = $('#nombre').val();
                var apellido = $('#apellido').val();
                return isEmpty(nombre) || isEmpty(apellido);

                                };

            function validarYGuardarDenunciante() {

                if (faltaCompletarLosDatos()) {
                    toastr.info("Ingrese nombre y apellido");
                } else {
                    guardarDenunciante();
                }
            };

            function isEmpty(id) {
                return id.length == 0
            }

            function guardarDenunciante() {
                mostrarLoading();
                $.ajax({
                    url: "/Home/Guardar",
                    type: "Post",
                    data: {
                        dni: $('#dni').val(),
                        nombre: $('#nombre').val(),
                        apellido: $('#apellido').val()
                    },
                    success: function (response) {
                        toastr.options.positionClass = 'toast-bottom-right';
                        ocultarLoading();
                        $('#denuncianteResult').html(response);
                        $('#denuncianteId').val($('#idDenunciante').val());
                        var id = $('#denuncianteId').val();
                        if (isEmpty(id)) {
                            toastr.info("Ya existe un Denunciante con esa descripción");
                        } else {
                            toastr.success("Se ha guardado correctamente");
                        }

                    },
                    error: function (response) {
                        toastr.error(response.statusCode + ' : ' + response.statusText);
                    }
                });

            }


            $("#alta").click(function () {
                $(this).attr("disable", true);
                validarYGuardarDenunciante();
                $(this).attr("disable", false);
            });

            $("#GuardarDenuncia").click(function () {
                //$(this).attr("disabled", true);
                $("html, body").animate({ scrollTop: $("#navHeader").offset().top }, 500);
                $.ajax({
                    url: "/Home/CrearDenuncia",
                    type: "Post",
                    data: {
                        DENUNCIANTE_ID: $('#denuncianteId').val(),
                        CREATIONDATE: $('#creationDate').val(),
                        FSELLOCIA: $('#fechaNotificacion').val(),
                        FSELLOGCIADC: $('#fechaNotificacionGcia').val(),
                        tipoEvento: $("#tipoEvento").val(),
                        reqInforme: $('#reqInforme').val(),
                        fechaVencimiento: $('#fechaVencimiento').val(),
                        horaVencimiento: $('#horaVencimiento').val()

                    },
                    success: function (response) {
                        toastr.options.positionClass = 'toast-bottom-right';
                        toastr.success("Se ha guardado correctamente");
                        $("#nroDenuncia").html(response);
                        //$(this).attr("disabled", false);

                    },
                    error: function (response) {
                        toastr.error("Ocurrió un Error Inesperado. No se ha podido guardar el Registro");
                        //$(this).attr("disabled", false);
                    }
                });

            });

            function getEventobyId(EventID) {
                $.ajax({

                    //url: "/Home/EditarEvento/" + EventID,
                    //type: "GET",
                    url: '@Url.Action("EditarEvento/", "Home")' /*+ EventID */, 
                    type: "post",
                    data: { id:EventID},
                    //contentType: "application/json;charset=UTF-8",
                    //dataType: "json",

                    success: function (result) {
                        $('#eventoAEditar').html(result);

                    },

                    error: function (result) {
                        //console.log(errormessage.responseText);

                        //alert(errormessage.responseText);
                        toastr.error(result.responseText)
                    }

                });

                return false;

            }


                                //});
                   function getEvento(EventID) {
                      $.ajax({

                        url: '@Url.Action("EditarEvento", "Home")',
                        type: "Post",
                        data: { id: EventID },
                                        //contentType: "application/json;charset=UTF-8",

                                        //dataType: "json",

                          success: function (result) {
                              $('#eventoEdicionDenunciaId').val(result.DenunciaId);
                              $('#eventoEdicionEventoId').val(result.EventoId);
                              $('#eventoEdicionContestado').val(result.contestado);
                              //$('#tipoEventoEdicionSeleccionado')
                              //$('#eventoEdicionFechaVencimiento')
                              //$('#eventoEdicionHoraVencimiento')


                                            //$('#EventoId').val(result.EventoId);

                                            //$('#Fecha').val(result.Fecha);

                                            //$('#tipoEvento').val(result.tipoEvento);

                                            //$('#Observacion').val(result.Observacion);

                                            //$('#Solucionado').val(result.Solucionado);

                                            $('#eventoAEditar').html(result);

                                        },

                                    error: function (errormessage) {
                                        console.log(errormessage.responseText);

                                        alert(errormessage.responseText);

                                    }

                                });

                                return false;

            }

        </script>
    }



